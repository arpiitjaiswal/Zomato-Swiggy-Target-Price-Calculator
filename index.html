<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reverse Settlement Calculator</title>

<style>
/* 1. Base Variables (Light Mode Default) */
:root{
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --input-bg:#f1f5f9;
  --accent:#2563eb;
  --ok:#16a34a;
  --bad:#dc2626;
  --shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* 2. System Dark Mode Support (Auto Detect) */
@media (prefers-color-scheme: dark) {
  :root {
    --bg:#0f172a;
    --card:#1e293b;
    --text:#f8fafc;
    --muted:#94a3b8;
    --border:#334155;
    --input-bg:#020617;
    --accent:#60a5fa;
  }
}

/* 3. Manual Dark Mode Override */
[data-theme="dark"]{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#f8fafc;
  --muted:#94a3b8;
  --border:#334155;
  --input-bg:#020617;
  --accent:#60a5fa;
}
[data-theme="light"]{
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e2e8f0;
  --input-bg:#f1f5f9;
  --accent:#2563eb;
}

*{box-sizing:border-box;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding: 20px 10px;
  transition: background 0.3s ease, color 0.3s ease;
}

.container{
  max-width:600px;
  margin:0 auto;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:24px;
  box-shadow:var(--shadow);
  border:1px solid var(--border);
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:24px;
}
.header h1{margin:0; font-size:1.25rem;}
.theme-btn{
  background:none; border:1px solid var(--border);
  padding:6px 12px; border-radius:8px; cursor:pointer; color:var(--text);
}

/* Main Input Area */
.main-input-group{
  margin-bottom:24px;
}
.main-label{
  display:block; font-weight:700; margin-bottom:8px; color:var(--text);
}
.currency-input{
  position:relative;
}
.currency-input span{
  position:absolute; left:16px; top:50%; transform:translateY(-50%);
  color:var(--muted); font-weight:600;
}
input.big-input{
  width:100%; padding:16px 16px 16px 32px;
  font-size:1.5rem; border-radius:12px;
  border:2px solid var(--border);
  background:var(--bg); color:var(--text); outline:none; font-weight:700;
}
input.big-input:focus{border-color:var(--accent);}

/* Grid for Settings */
.settings-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
  margin-bottom:24px;
}
.setting-item label{
  display:block; font-size:0.85rem; color:var(--muted); margin-bottom:6px;
}

/* Updated Simple Input Style (No suffix) */
input.simple-input{
  width:100%; padding:12px;
  border-radius:8px; border:1px solid var(--border);
  background:var(--input-bg); color:var(--text); font-size:1rem;
  outline:none;
}
input.simple-input:focus{border-color:var(--accent); background:var(--card);}

.full-width{
  grid-column: span 2;
}

/* Accordion Results Section */
.result-section{
  background:var(--input-bg);
  border-radius:12px;
  overflow:hidden;
  border:1px solid var(--border);
}

.acc-item {
  border-bottom: 1px solid var(--border);
}
.acc-item:last-child {
  border-bottom: none;
}

.acc-header {
  padding: 16px;
  background: var(--input-bg);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  user-select: none;
}
.acc-header:hover {
  background: var(--bg);
}
.acc-header .title {
  display: flex;
  align-items: center;
  gap: 8px;
}
.acc-header .amount {
  font-weight: 700;
}
.acc-icon {
  font-size: 0.8rem;
  transition: transform 0.2s;
}

/* Expand Logic */
.acc-body {
  display: none;
  padding: 0 16px 16px 16px;
  background: var(--input-bg);
  border-top: 1px dashed var(--border);
}
.acc-item.open .acc-body {
  display: block;
  animation: slideDown 0.2s ease-out;
}
.acc-item.open .acc-icon {
  transform: rotate(180deg);
}

/* Rows inside body */
.row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0; /* Slightly more breathing room */
  font-size: 0.9rem;
  color: var(--muted);
}
.row span:first-child {
    display: flex;
    align-items: center;
    gap: 8px;
}
.row span:last-child {
  color: var(--text);
  font-weight: 500;
}

/* Percentage Badge Style */
.pct-label {
  font-size: 0.8rem;
  color: var(--muted);
  font-weight: 500;
}

/* Colors for sections */
.val-positive { color: var(--ok); }

/* UPDATED: Added !important to ensure red color overrides the default row color */
.val-negative { color: var(--bad) !important; }

/* Final Total */
.final-row {
  padding: 20px;
  background: var(--card);
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-top: 2px solid var(--border);
}
.final-label { font-weight: 700; font-size: 1.1rem; }
.final-amount { font-weight: 800; font-size: 1.4rem; color: var(--ok); }

@keyframes slideDown {
  from {opacity:0; transform:translateY(-5px);}
  to {opacity:1; transform:translateY(0);}
}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="header">
      <h1>Zomato/Swiggy Payout Calculator</h1>
      <button class="theme-btn" onclick="toggleTheme()">ðŸŒ—</button>
    </div>

    <div class="main-input-group">
      <label class="main-label">Enter Payout Amount:</label>
      <div class="currency-input">
        <span>â‚¹</span>
        <input type="number" id="desiredPayout" class="big-input" placeholder="0.00" oninput="calc()">
      </div>
    </div>

    <div class="settings-grid">
      <div class="setting-item">
        <label>GST on Item (%)</label>
        <input type="number" id="gst" value="5" class="simple-input" oninput="calc(); updatePercentageLabels()">
      </div>

      <div class="setting-item">
        <label>Platform Commission Fee (%)</label>
        <input type="number" id="comm" value="30" class="simple-input" oninput="calc(); updatePercentageLabels()">
      </div>

      <div class="setting-item">
        <label>Payment Gateway Fee (%)</label>
        <input type="number" id="pg" value="1.84" class="simple-input" oninput="calc(); updatePercentageLabels()">
      </div>

      <div class="setting-item">
        <label>GST on Platform Fees (%)</label>
        <input type="number" id="gstOnFee" value="18" class="simple-input" oninput="calc(); updatePercentageLabels()">
      </div>

      <div class="setting-item full-width">
        <label>Packaging Charges (â‚¹)</label>
        <input type="number" id="pack" placeholder="Enter your Packaging Charges" class="simple-input" oninput="calc()">
      </div>
    </div>

    <div class="result-section">
      
      <div class="acc-item open">
        <div class="acc-header" onclick="toggleAcc(this)">
          <span class="title">A. Bill Amount <small class="acc-icon">â–¼</small></span>
          <span class="amount" id="res_a_total">â‚¹ 0.00</span>
        </div>
        <div class="acc-body">
          <div class="row"><span>Item Value (Excl. Tax)</span> <span id="res_a_base">â‚¹ 0.00</span></div>
          <div class="row"><span>Packaging Charges</span> <span id="res_a_pack">â‚¹ 0.00</span></div>
          <div class="row"><span id="res_a_gst_label">GST Collected on Item</span> <span id="res_a_gst">â‚¹ 0.00</span></div>
        </div>
      </div>

      <div class="acc-item open">
        <div class="acc-header" onclick="toggleAcc(this)">
          <span class="title">B. Platform Fees <small class="acc-icon">â–¼</small></span>
          <span class="amount val-negative" id="res_b_total">- â‚¹ 0.00</span>
        </div>
        <div class="acc-body">
          <div class="row"><span id="res_b_comm_label">Platform Commission Fee</span> <span id="res_b_comm" class="val-negative">- â‚¹ 0.00</span></div>
          <div class="row"><span id="res_b_pg_label">Payment Gateway Fee</span> <span id="res_b_pg" class="val-negative">- â‚¹ 0.00</span></div>
        </div>
      </div>

      <div class="acc-item open">
        <div class="acc-header" onclick="toggleAcc(this)">
          <span class="title">C. Taxes <small class="acc-icon">â–¼</small></span>
          <span class="amount val-negative" id="res_c_total">- â‚¹ 0.00</span>
        </div>
        <div class="acc-body">
          <div class="row"><span id="res_c_gst_fee_label">GST on Platform Fees</span> <span id="res_c_gst_fee" class="val-negative">- â‚¹ 0.00</span></div>
          <div class="row"><span id="res_c_gst_remit_label">GST Collected on Item to Govt.</span> <span id="res_c_gst_remit" class="val-negative">- â‚¹ 0.00</span></div>
        </div>
      </div>

      <div class="final-row">
        <span class="final-label">Net Payout</span>
        <span class="final-amount" id="res_final">â‚¹ 0.00</span>
      </div>

    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    updatePercentageLabels();
    calc();
});

function toggleTheme(){
  // Toggles between specific overrides
  const html = document.documentElement;
  // If no attribute set, check media query to decide next state
  if(!html.hasAttribute("data-theme")){
    const isDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    html.dataset.theme = isDark ? "light" : "dark";
  } else {
    html.dataset.theme = html.dataset.theme === "dark" ? "light" : "dark";
  }
}

function toggleAcc(header){
  header.parentElement.classList.toggle('open');
}

function updatePercentageLabels() {
    const gstVal = parseFloat(document.getElementById('gst').value) || 0;
    const commVal = parseFloat(document.getElementById('comm').value) || 0;
    const pgVal = parseFloat(document.getElementById('pg').value) || 0;
    const gstFeeVal = parseFloat(document.getElementById('gstOnFee').value) || 0;

    // A. GST Collected
    document.getElementById('res_a_gst_label').innerHTML = `GST Collected on Item <span class="pct-label">(${gstVal}%)</span>`;
    
    // B. Platform Fees
    document.getElementById('res_b_comm_label').innerHTML = `Platform Commission <span class="pct-label">(${commVal}%)</span>`;
    document.getElementById('res_b_pg_label').innerHTML = `Payment Gateway Fee <span class="pct-label">(${pgVal}%)</span>`;

    // C. Taxes
    document.getElementById('res_c_gst_fee_label').innerHTML = `GST on Platform Fees <span class="pct-label">(${gstFeeVal}%)</span>`;
    document.getElementById('res_c_gst_remit_label').innerHTML = `GST Collected on Item to Govt. <span class="pct-label">(${gstVal}%)</span>`;
}

// Helper: Formats currency. If isDeduction is true, makes it red with a minus sign.
function fmt(val, isDeduction = false) {
    const formatted = `â‚¹ ${val.toFixed(2)}`;
    if(isDeduction) {
        return `<span class="val-negative">- ${formatted}</span>`;
    }
    return formatted;
}

function calc(){
  let payout = parseFloat(document.getElementById('desiredPayout').value);
  const gst = parseFloat(document.getElementById('gst').value) / 100 || 0;
  const comm = parseFloat(document.getElementById('comm').value) / 100 || 0;
  const pg = parseFloat(document.getElementById('pg').value) / 100 || 0;
  const gstOnFee = parseFloat(document.getElementById('gstOnFee').value) / 100 || 0;
  const pack = parseFloat(document.getElementById('pack').value) || 0;
  
  if(isNaN(payout)) payout = 0;

  // --- REVERSE LOGIC ---
  const feePercent = comm + pg;
  const taxOnFeePercent = feePercent * gstOnFee;
  const taxOnItemPercent = 1 - (1 / (1 + gst));

  const totalDeductionRatio = feePercent + taxOnFeePercent + taxOnItemPercent;

  let requiredSP = 0;
  let impossible = false;
  
  if(totalDeductionRatio >= 1){
      impossible = true;
  } else {
      requiredSP = payout / (1 - totalDeductionRatio);
  }
  
  if(payout === 0) requiredSP = 0;

  if(impossible) {
      document.getElementById('res_a_total').innerText = "Impossible";
      document.getElementById('res_final').innerText = "Impossible";
      return;
  }

  // --- Calculations ---
  const itemBaseVal = Math.max(0, (requiredSP - pack) / (1 + gst));
  const gstCollected = requiredSP - (requiredSP / (1+gst));
  
  const b_comm = requiredSP * comm;
  const b_pg = requiredSP * pg;
  const b_total = b_comm + b_pg;
  
  const c_gst_fee = b_total * gstOnFee;
  const c_gst_remit = gstCollected; 
  const c_total = c_gst_fee + c_gst_remit;

  // --- Update UI ---
  
  // Section A
  document.getElementById('res_a_total').innerText = `â‚¹ ${requiredSP.toFixed(2)}`;
  document.getElementById('res_a_base').innerText = `â‚¹ ${itemBaseVal.toFixed(2)}`;
  document.getElementById('res_a_pack').innerText = `â‚¹ ${pack.toFixed(2)}`;
  document.getElementById('res_a_gst').innerText = `â‚¹ ${gstCollected.toFixed(2)}`;

  // Section B
  document.getElementById('res_b_total').innerHTML = fmt(b_total, true);
  document.getElementById('res_b_comm').innerHTML = fmt(b_comm, true);
  document.getElementById('res_b_pg').innerHTML = fmt(b_pg, true);

  // Section C
  document.getElementById('res_c_total').innerHTML = fmt(c_total, true);
  document.getElementById('res_c_gst_fee').innerHTML = fmt(c_gst_fee, true);
  document.getElementById('res_c_gst_remit').innerHTML = fmt(c_gst_remit, true);

  // Final
  document.getElementById('res_final').innerText = `â‚¹ ${payout.toFixed(2)}`;
}
</script>

</body>
</html>